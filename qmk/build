#!/usr/bin/env bash

set -euo pipefail

KEYBOARDS=(
  keebio/sinc/rev3
  keebio/quefrency/rev4
  annepro2/c18
)

function main() {
  ./install-symlinks

  if [ "${1:-}" == "all" ]; then
    qmk-compile "${KEYBOARDS[@]}"
  elif [ $# -gt 0 ]; then
    qmk-compile "$@"
  else
    qmk-compile "$(pick-keyboard)"
  fi
}

function qmk-compile() {
  for kb in "$@"; do
    qmk compile -kb "$kb" -km elentok
  done
}

function pick-keyboard() {
  list-keyboards | fzf-tmux -p
}

function list-keyboards() {
  for kb in "${KEYBOARDS[@]}"; do
    echo "$kb"
  done
}
#
# if [ "${1:-}" == "all" ]; then
#   for kb in "${KEYBOARDS[@]}"; do
#     qmk compile -kb "$kb" -km elentok
#   done
# elif [ $# -gt 0 ]; then
#   for kb in "$@"; do
#     qmk compile -kb "$kb" -km elentok
#   done
# else
#   kb="$(for kb in "${KEYBOARDS[@]}"; do echo "$kb"; done | fzf-tmux -p)"
#   if [ -n "$kb" ]; then
#     echo "> qmk compile -kb $kb -km elentok"
#     qmk compile -kb "$kb" -km elentok
#   fi
# fi

main "$@"
